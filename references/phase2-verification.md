# Phase 2: Verification Reference

## Verification Process

For each checkpoint in QA_ANALYSIS.md, follow this procedure:

### 1. Locate

Find the exact file(s) and line(s) relevant to the checkpoint.

### 2. Read

Read the code thoroughly. For integration checks, read both sides of the integration.

### 3. Trace

Follow the execution path:
- **Forward trace**: From the entry point, follow calls down through the stack
- **Backward trace**: From the output/effect, trace back to the trigger
- **Data trace**: Follow a data value from input to storage/output

### 4. Evaluate

Apply the specific checkpoint criteria. Determine:
- **PASS**: Code is correct and complete for this checkpoint
- **FAIL**: Code has a defect, gap, or violation
- **WARN**: Code works but has a smell, risk, or improvement opportunity

### 5. Document

Record the result with evidence:
```
- [x] **PASS** — Checkpoint description
- [ ] **FAIL** — Checkpoint description
  > Finding: [description of issue]
  > Location: `file.ext:line`
  > Severity: CRITICAL | HIGH | MEDIUM | LOW
  > Evidence: [code snippet or explanation]
- [ ] **WARN** — Checkpoint description
  > Finding: [description of concern]
  > Location: `file.ext:line`
  > Severity: MEDIUM | LOW
  > Suggestion: [recommended improvement]
```

## QA_REPORT.md Template

```markdown
# QA Verification Report

> Generated by Agent QA — Phase 2
> Project: [name]
> Date: [date]
> Analysis source: agent_qa/QA_ANALYSIS.md

## Executive Summary

| Metric          | Count |
|----------------|-------|
| Total checkpoints | N   |
| PASS           | N     |
| FAIL           | N     |
| WARN           | N     |
| Health score   | N%    |

### Critical Findings
[List any CRITICAL severity FAILs here — these need immediate attention]

### Top Issues
1. [Most impactful finding]
2. [Second most impactful]
3. [Third most impactful]

---

## Module: [module_name]

### Functionality: [functionality_name]

- [x] **PASS** — Integration: All imports resolve correctly
- [ ] **FAIL** — Data flow: Input validation missing
  > Finding: User input passed directly to database query without sanitization
  > Location: `src/api/users.py:47`
  > Severity: CRITICAL
  > Evidence: `db.execute(f"SELECT * FROM users WHERE id = {user_id}")`
- [x] **PASS** — Naming: Follows snake_case convention
- [ ] **WARN** — Error handling: Generic exception catch
  > Finding: Bare `except:` catches all exceptions including SystemExit
  > Location: `src/api/users.py:52`
  > Severity: MEDIUM
  > Suggestion: Catch specific exception types

### Functionality: [next_functionality]
...

---

## Module: [next_module]
...

---

## Cross-Cutting Concerns
...

---

## Summary by Severity

### CRITICAL
| # | Module | Functionality | Issue | Location |
|---|--------|--------------|-------|----------|
| 1 | ...    | ...          | ...   | ...      |

### HIGH
| # | Module | Functionality | Issue | Location |
|---|--------|--------------|-------|----------|

### MEDIUM
| # | Module | Functionality | Issue | Location |
|---|--------|--------------|-------|----------|

### LOW
| # | Module | Functionality | Issue | Location |
|---|--------|--------------|-------|----------|
```

## Severity Classification

| Severity | Criteria | Examples |
|----------|----------|---------|
| **CRITICAL** | Breaks functionality, security vulnerability, data loss risk | SQL injection, unhandled null causing crash, auth bypass |
| **HIGH** | Incorrect behavior, data integrity risk, significant logic error | Wrong calculation, missing validation at API boundary, race condition |
| **MEDIUM** | Code smell, maintainability risk, minor logic concern | Generic exception handling, magic numbers, inconsistent naming |
| **LOW** | Style issue, minor improvement opportunity, convention deviation | Missing type annotation, verbose code, minor naming inconsistency |

## Verification Strategies by Check Type

### Integration Checks
1. Read the import/require statement
2. Verify the imported module/function exists at the referenced path
3. Verify the function signature matches its usage (argument count, types)
4. Check for version-specific API usage against dependency version

### Data Flow Checks
1. Identify the data entry point (API input, file read, user event)
2. Trace each transformation step
3. Verify no data is lost or corrupted between steps
4. Check the final output/storage matches the expected format

### Logic Checks
1. Identify all conditional branches
2. Verify each branch handles its case correctly
3. Check for missing else/default cases
4. Verify loop bounds and termination
5. Check arithmetic for off-by-one, overflow, precision issues

### Naming Convention Checks
1. Identify the project's convention from existing code
2. Verify files, variables, functions, classes follow it
3. Flag inconsistencies with specific locations

### Security Checks
1. Grep for hardcoded strings that look like secrets/keys/tokens
2. Trace user input to see if it reaches sensitive operations unsanitized
3. Check authentication/authorization on protected endpoints
4. Verify secrets come from environment/config, not source code

## Work Queue Strategy

Process checkpoints in this order for maximum efficiency:
1. **By module**: Complete all checkpoints for one module before moving to the next
2. **Within module, by file**: Group checkpoints that reference the same file
3. **Cross-cutting last**: Verify cross-cutting concerns after all modules

This minimizes file re-reading and keeps context focused.
